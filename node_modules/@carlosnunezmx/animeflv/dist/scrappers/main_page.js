"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.GetNewEpisodes = exports.GetNewSeries = exports.GetHome = void 0;
const config_js_1 = __importDefault(require("../config.js"));
const fetch_js_1 = require("./fetch.js");
async function GetHome() {
    const request = await (0, fetch_js_1.fetchResource)({
        resource: config_js_1.default.baseURL
    });
    const Series = await GetNewSeries(request);
    const Episodes = await GetNewEpisodes(request);
    return {
        Series,
        Episodes
    };
}
exports.GetHome = GetHome;
;
async function GetNewSeries(request) {
    if (!request)
        request = await (0, fetch_js_1.fetchResource)({ resource: config_js_1.default.baseURL });
    const $SeriesAnimeList = request.querySelectorAll(".ListAnimes li article.Anime");
    const Animes = [];
    $SeriesAnimeList.forEach($anime => {
        // @ts-ignore
        let Result = {};
        Result.Id = $anime.querySelector("a")?.getAttribute("href")?.replace("/anime/", "") ?? "";
        Result.Image = $anime.querySelector(".Image figure img")?.getAttribute("src") ?? "";
        Result.Image = Result.Image.includes('https://animeflv.net') ? Result.Image : config_js_1.default.baseURL + Result.Image;
        Result.Type = $anime.querySelector(".Image .Type")?.innerText ?? "";
        Result.Title = $anime.querySelector(".Title")?.innerText ?? "";
        let Review = $anime.querySelector(".Vts")?.innerText ?? "0";
        Result.Review = Number(Review);
        Result.Description = $anime
            .querySelectorAll(".Description p")[1]
            .innerText;
        Animes.push(Result);
    });
    return Animes;
}
exports.GetNewSeries = GetNewSeries;
/**
 *
 * @param {import("node-html-parser").HTMLElement?} request
 */
async function GetNewEpisodes(request) {
    if (!request)
        request = await (0, fetch_js_1.fetchResource)({ resource: config_js_1.default.baseURL });
    const $EpList = request.querySelectorAll(".ListEpisodios li a");
    if ($EpList.length == 0)
        throw "Hay un error desconocido";
    const Episodes = [];
    $EpList.forEach($episodio => {
        const Id = $episodio.getAttribute("href")?.replace("/ver/", "") ?? "";
        const Image = config_js_1.default.baseURL + $episodio.querySelector(".Image img")?.getAttribute("src") ?? "";
        let Title = $episodio.querySelector(".Capi")?.innerHTML ?? "";
        const Anime = $episodio.querySelector("strong.Title")?.innerHTML ?? "";
        Episodes.push({ Id, Image, Title, Anime });
    });
    return Episodes;
}
exports.GetNewEpisodes = GetNewEpisodes;
